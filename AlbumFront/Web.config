<?xml version="1.0" encoding="utf-8"?>
<!--   
    Note: As an alternative to hand editing this file you can use the 
    web admin tool to configure settings for your application. Use
    the Website->Asp.Net Configuration option in Visual Studio.
    A full list of settings and comments can be found in 
    machine.config.comments usually located in 
    \Windows\Microsoft.Net\Framework\v2.x\Config 
-->
<configuration>
  <configSections>
    
	<sectionGroup name="elmah">
		<section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah" />
		<section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah" />
		<section name="errorMail" requirePermission="false" type="Elmah.ErrorMailSectionHandler, Elmah" />
		<section name="errorFilter" requirePermission="false" type="Elmah.ErrorFilterSectionHandler, Elmah" />
	</sectionGroup>
  <!--
            BotDetect configuration:

            If your project is not going to be using the Simple API,
            the "Simple API: ..." configuration lines bellow can be safely removed.

            If your project is not going to be using the Traditional API,
            the "Traditional API: ..." configuration lines bellow can be safely removed.
        --><!-- Traditional API: Register the BotDetect's Configuration section --><section name="botDetect" requirePermission="false" type="BotDetect.Configuration.BotDetectConfigurationSection, BotDetect" /></configSections>
  <appSettings>
    <add key="ValidationSettings:UnobtrusiveValidationMode" value="Webforms" />
    <add key="contact-email" value="" />
    <add key="sys-source-email" value="" />
    <add key="smtp-host" value="" />
    <add key="smtp-port" value="25" />
    <add key="smtp-login" value="" />
    <add key="smtp-pwd" value="" />
	<!-- Основной домен: он прописывается в meta и на него идёт redirect, если задан непустой -->
	<add key="CanonicalDomain" value="afedorov.info" />
	<!-- localhost и технические домены исключаются из редиректа -->
	<add key="TechDomains" value="afedorov-info.1gb.ru,through-horizon.1gb.ru" />
	<!-- Если true, то идёт редирект на HTTPS. Если задан канонический домен, то на него, иначе на тот же, что в запросе. -->
	<add key="EnforceHttps" value="true" />
	<add key="HomePageTitle" value="Ὀδύσσεια ---== Odyssey's Photos ==--- Ὀδύσσεια" />
  </appSettings>

	<!--system.diagnostics>
		<trace autoflush="true" indentsize="4">
			<listeners>
				<add name="MyFileListener"
						type="System.Diagnostics.TextWriterTraceListener"
						initializeData="App_Data\trace.log" />
				<remove name="Default" />
			</listeners>
		</trace>
	</system.diagnostics-->
	
  <!--location>
    <system.web>
      <trust level="High"/>
    </system.web>
  </location-->
  <!--
    For a description of web.config changes see http://go.microsoft.com/fwlink/?LinkId=235367.

    The following attributes can be set on the <httpRuntime> tag.
      <system.Web>
        <httpRuntime targetFramework="4.5" />
      </system.Web>
  -->
  <system.web>
    <!-- Traditional API: Register a custom SessionIDManager for BotDetect requests -->
	  <sessionState mode="InProc" cookieless="AutoDetect" timeout="20" sessionIDManagerType="BotDetect.Web.CustomSessionIdManager, BotDetect" />	  
	  <!-- Traditional API: Ensuring Session State is enabled -->
	  <pages buffer="true" masterPageFile="~/OuterMasterPage.master" enableSessionState="false" enableViewState="false" clientIDMode="AutoID" controlRenderingCompatibilityVersion="4.0">
      <namespaces>
        <add namespace="System.Web.Optimization" />
      </namespaces>
      <controls>
        <add assembly="Microsoft.AspNet.Web.Optimization.WebForms" namespace="Microsoft.AspNet.Web.Optimization.WebForms" tagPrefix="webopt" />
        <add assembly="BotDetect" namespace="BotDetect.Web.UI" tagPrefix="BotDetect" />
      </controls>
    </pages>
    <!-- 
            Set lation debug="true" to insert debugging 
            symbols into the compiled page. Because this 
            affects performance, set this value to true only 
            during development.
     -->
    <compilation debug="true" defaultLanguage="c#" targetFramework="4.8" />
    <httpRuntime targetFramework="4.8" />
    <!--
            The <authentication> section enables configuration 
            of the security authentication mode used by 
            ASP.NET to identify an incoming user. 
     -->
    <trace enabled="false" requestLimit="10" pageOutput="false" traceMode="SortByTime" localOnly="true" />
    <customErrors mode="Off" />
    <globalization requestEncoding="utf-8" responseEncoding="utf-8" />	    
  </system.web>
  <system.webServer>	  	  	  
	  <httpErrors errorMode="DetailedLocalOnly" />
    <validation validateIntegratedModeConfiguration="true" />
	<modules runAllManagedModulesForAllRequests="false">
		<add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" preCondition="managedHandler" />
		<add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" preCondition="managedHandler" />
		<add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" preCondition="managedHandler" />	
	</modules>
    <handlers>            
        <!-- http://weblog.west-wind.com/posts/2012/Oct/25/Caveats-with-the-runAllManagedModulesForAllRequests-in-IIS-78 -->
        <!-- Fix for XP: http://support.microsoft.com/kb/980368 -->
        <!-- Чтобы работали URL без точки для роутинга -->
        <!-- Simple API: Register the HttpHandler used for BotDetect requests (IIS 7.0+) --><!-- Traditional API: Register the HttpHandler used for BotDetect requests (IIS 7.0+) --><remove name="ExtensionlessUrlHandler-Integrated-4.0" />
        <add name="ExtensionlessUrlHandler-Integrated-4.0" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" type="System.Web.Handlers.TransferRequestHandler" preCondition="integratedMode,runtimeVersionv4.0" />
        <add name="h-test" verb="*" path="*.xsl" type="TestFileHandler" />
        <remove name="SimpleCaptchaEndpoint" />
		<remove name="BotDetectCaptchaHandler" />
		<add name="BotDetectCaptchaHandler" preCondition="integratedMode" verb="GET" path="BotDetectCaptcha.ashx" type="BotDetect.Web.CaptchaHandler, BotDetect" />		
		<remove name="BotDetectCaptchaHandler" />
		<add name="BotDetectCaptchaHandler"
			 preCondition="integratedMode"
			 verb="GET"
			 path="BotDetectCaptcha.ashx"
			 type="BotDetect.Web.CaptchaHandler, BotDetect" />
	</handlers>
    <staticContent>
      <remove fileExtension=".mp4" />
      <mimeMap fileExtension=".mp4" mimeType="video/mp4" />
	  <remove fileExtension=".woff" />
	  <mimeMap fileExtension=".woff" mimeType="application/font-woff" />
	  <remove fileExtension=".woff2" />
	  <mimeMap fileExtension=".woff2" mimeType="font/woff2" />
	  <remove fileExtension=".ttf" />
	  <mimeMap fileExtension=".ttf" mimeType="font/ttf" />
	  <remove fileExtension=".json" />
	  <mimeMap fileExtension=".json" mimeType="application/json" />
	  <remove fileExtension=".xml" />
	  <mimeMap fileExtension=".xml" mimeType="application/xml" />
    </staticContent>	  		  	     
  </system.webServer>
    

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="WebGrease" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-1.6.5135.21930" newVersion="1.6.5135.21930" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-13.0.0.0" newVersion="13.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Antlr3.Runtime" publicKeyToken="eb42632606e9261f" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.5.0.2" newVersion="3.5.0.2" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Microsoft.Web.Infrastructure" publicKeyToken="31bf3856ad364e35" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.0.0.0" newVersion="2.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Data.SQLite" publicKeyToken="db937bc2d44ff139" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-1.0.119.0" newVersion="1.0.119.0" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>

  <elmah>
	    <!--
        See http://code.google.com/p/elmah/wiki/SecuringErrorLogPages for 
        more information on remote access and securing ELMAH.
        -->
	    <!--
        See http://code.google.com/p/elmah/wiki/SecuringErrorLogPages for 
        more information on remote access and securing ELMAH.
    --><security allowRemoteAccess="true" />
	    <errorLog type="Elmah.XmlFileErrorLog, Elmah" logPath="~/App_Data/ELMAH" />        
  </elmah>
</configuration>
